/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package smbtest;

import java.util.concurrent.SynchronousQueue;
import jcifs.smb.INtlmContext;
import jcifs.smb.SmbException;

/**
 *
 * @author dev
 */
public class QueuedNtlmContext implements INtlmContext {
    
    int _state;    
    SynchronousQueue<byte[]> _queue;
    
    @Override
    public boolean isEstablished() {
        return _state > 1;
    }
    
    public QueuedNtlmContext(SynchronousQueue<byte[]> queue) {
        _queue = queue;
    }

    @Override
    public byte[] getServerChallenge() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public byte[] getSigningKey() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public String getNetbiosName() {
        return "Hello";
    }

    @Override
    public byte[] initSecContext(byte[] token, int offset, int len) throws SmbException {
        try {
            System.out.println("initSecContext - State " + _state);
            if(_state == 0) {                
                _state++;
                return _queue.take();
            } else if(_state == 1) {                
                _state++;
                _queue.put(token);
                return _queue.take();
            }      
        } catch(InterruptedException e) {
            throw new SmbException("Error", e);
        }
        
        return new byte[0];
    }
}
